<% status = @platform.ciAttributes.autoreplace == 'true' ? 'enabled' : 'disabled'
   has_operations = has_operations?(@assembly.ciId)%>
<div class="marker">
  <%= status_marker('autoreplace', status, state_to_label(status)) %>
</div>
<div class="description">
  <ul>
    <li>
      <%= icon('time', ' ') %> Autoreplace <%= highlight(status) %>
      <%= time_ago_in_words(Time.at(@platform_detail.attributes[:attributes].autoreplace.updated/1000)) %>
    </li>
  </ul>
  <% if has_operations %>
    <ul class="status-actions">
      <% if status == 'enabled' %>
        <li><%= link_to(icon_button('arrow-left', 'Disable', ''), autoreplace_assembly_operations_environment_platform_path(@assembly, @environment, @platform, :status => 'disable'), :method => :put, :remote => true) %></li>
      <% else %>
        <li><%= link_to(icon_button('arrow-left', 'Enable', 'success'), autoreplace_assembly_operations_environment_platform_path(@assembly, @environment, @platform, :status => 'enable'), :method => :put, :remote => true) %></li>
      <% end %>
    </ul>
  <% end %>
  <br/>
  <div id="autoreplace_attrs">
    <hr/>
    <% if has_operations %>
      <div class="pull-right">
        <%= link_to_function(icon('edit', 'Edit'), "enable_edit('autoreplace_attrs')", :class => 'btn btn-mini')  %>
      </div>
    <% end %>
    <%= form_tag autoreplace_assembly_operations_environment_platform_path(@assembly, @environment, @platform), :method => :put, :remote => true, :class => 'form-horizontal' do %>
      <% %w(replace_after_minutes replace_after_repairs).each do |a| %>
        <% meta = @platform.meta.md_attribute(a) %>
        <div class="control-group">
          <%= label_tag a, link_to(meta.description, '#', :tabindex => '-1', :rel => 'tooltip', :title => "#{meta.options[:help]}"), :class => 'control-label' %>
          <div class="controls">
            <%= number_field_tag a, @platform.ciAttributes.attributes[a], :class => 'input-small', :min => 1 %>
          </div>
        </div>
      <% end %>
      <div class="toolbar form-actions">
        <%= button_tag((icon('ok', 'Save')), :disable_with => 'Saving...', :class => 'btn btn-success') %>
        <%= link_to_function(icon('remove', 'Cancel'), "disable_edit('autoreplace_attrs')", :class => 'btn btn-danger') %>
      </div>
    <% end %>
  </div>
  <script>
    disable_edit('autoreplace_attrs');
  </script>
</div>
