<%= f.hidden_field :ciId if ci.persisted? %>
<%= f.hidden_field :ciClassName %>
<%= f.hidden_field :nsPath %>
<% read_only_x = (defined?(read_only) && read_only)
   editable = !read_only_x && ci.name_editable?
   if editable %>
  <div class="control-group" style="margin-top: 10px">
    <%= f.label :ciName, 'Name', :class => 'control-label' %>
    <div class="controls"><%= f.text_field :ciName, :class => 'input-xlarge', :required => true, :pattern => Cms::Ci::VALID_CI_NAME_REGEXP %>
      <br/><em>must be unique with at least one letter character, 32 characters max</em>
    </div>
  </div>
<% else %>
  <div>
    <%= f.hidden_field :ciName %>
  </div>
<% end %>
<% if ci.persisted? %>
  <dl class="dl-horizontal">
    <% unless editable %>
      <dt>Name</dt>
      <dd><%= ci.ciName %></dd>
    <% end %>
    <dt>Id</dt>
    <dd><%= ci.ciId %></dd>
    <dt>Namespace</dt>
    <dd><%= ci.nsPath %></dd>
    <% unless editable %>
      <dt>Created</dt>
      <dd><%= time_ago_in_words(ci.created_timestamp) %> by <%= ci.createdBy %></dd>
      <% unless ci.created == ci.updated %>
        <dt>Updated</dt>
        <dd><%= time_ago_in_words(ci.updated_timestamp) %><%= raw(" by #{ci.updatedBy}") if ci.updatedBy %></dd>
      <% end %>
    <% end %>
    <% if Settings.check_policy_compliance %>
      <% policies = ci.violates_policies %>
      <dt>Policy Compliance</dt>
      <% if policies.nil? %>
        <dd class="text-error"><%= icon('warning-sign') %> <strong>Failed to check policy compliance</strong></dd>
      <% elsif policies.empty? %>
        <dd><%= marker('passed', 'label-success') %></dd>
      <% else %>
        <dd>
          <%= marker('failed', 'label-important') %><br/>
          <ul class="unstyled" style="margin-left:10px">
            <% policies.each do |p| %>
              <li>
                <strong><%= p.ciName %></strong>
                <% desc = p.ciAttributes.description %>
                <% if desc.present? %>
                  - <%= desc %>
                <% end %>
                <% doc_url = p.ciAttributes.docurl %>
                <%= link_to(icon('book', 'more...'), doc_url, :target => '_blank') if doc_url.present? %>
              </li>
            <% end %>
          </ul>
        </dd>
      <% end %>
    <% end %>
  </dl>
  <% if ci.respond_to?(:rfcId) && ci.rfcId.to_i > 0 %>
    <div class="category">
      <div class="name">Request For Change</div>
      <dl class="dl-horizontal">
        <dt>Action</dt>
        <dd><div class="inline-block"><%= marker(ci.rfcAction, action_to_label(ci.rfcAction)) %></div></dd>
        <dt>Created</dt>
        <dd><%= time_ago_in_words(ci.rfc_created_timestamp) %> by <%= ci.rfcCreatedBy %></dd>
        <% unless ci.rfcCreated == ci.rfcUpdated %>
          <dt>Updated</dt>
          <dd><%= time_ago_in_words(ci.rfc_updated_timestamp) %><%= raw(" by #{ci.rfcUpdatedBy}") if ci.rfcUpdatedBy %></dd>
        <% end %>
        <dt>Diff to base</dt>
        <dd><%= link_to_function('Show', 'toggleBaseDiff(this)') %></dd>
      </dl>
    </div>
  <% end %>
<% end %>
